{"default_url":null,"content":{"state":0,"taskInstructions":null,"references":[],"isTaskInstructionsVisible":true,"isCommentMandatory":false,"fields":[],"masterFinding":{"id":17051556,"exploitInstructions":"","verificationInstructions":"","remediationInstructions":"Analyze and harden client side (JavaScript) code. Additionally, sanitize input sources which can be influenced by an attacker. For example:<br><ul><li>document.URL</li><br><li>document.URLUnencoded</li><br><li>document.location (and many of its properties)</li><br><li>document.referrer</li><br><li>window.location (and many of its properties)</li><br></ul><br>Special attention should be given to scenarios in which the DOM is modified. For example: <br><br>Write raw HTML, e.g.:<br><ul><li>document.write(...)</li><br><li>document.writeln(...)</li><br><li>document.body.innerHtml=...</li><br></ul><br>Directly modifying the DOM (including DHTML events), e.g.:<br><ul><li>document.forms[0].action=... (and various other collections)</li><br><li>document.attachEvent(...)</li><br><li>document.create...(...)</li><br><li>document.execCommand(...)</li><br><li>document.body. ... (accessing the DOM through the body object)</li><br><li>window.attachEvent(...)</li><br></ul><br>Replacing the document URL, e.g.:<br><ul><li>document.location=... (and assigning to location's href, host</li><br><li>and hostname)</li><br><li>document.location.hostname=...</li><br><li>document.location.replace(...)</li><br><li>document.location.assign(...)</li><br><li>document.URL=...</li><br><li>window.navigate(...)</li><br></ul><br>Opening/modifying a window, e.g.:<br><ul><li>document.open(...)</li><br><li>window.open(...)</li><br><li>window.location.href=... (and assigning to location's href, host</li><br><li>and hostname)</li><br></ul><br>Directly executing script, e.g.:<br><ul><li>eval(...)</li><br><li>window.execScript(...)</li><br><li>window.setInterval(...)</li><br><li>window.setTimeout(...)</li><br></ul><br>Consider the following vulnerable script:<br><br><code>&lt;SCRIPT&gt;<br>var position=document.URL.indexOf(\"age=\")+4;<br>document.write(document.URL.substring(position,document.URL.length));<br>&lt;/SCRIPT&gt;<br></code><br>In this example the age parameter isn't sanitized, therefore the script is susceptible to DOM Cross-Site Scripting attacks.<br>A safe version of this script would be:<br><br><code>&lt;SCRIPT&gt;<br>  var position=document.URL.indexOf(\"age=\")+4;<br>  var age=document.URL.substring(position,document.URL.length);<br>  if (age.match(/^[0-9]&#42;$/))<br>  {<br>        document.write(age);<br>  }<br> else<br> {<br>       window.alert(\"Illegal input.\<br>Age parameter should be composed from numerical characters only.\");<br> }<br>&lt;/SCRIPT&gt;<br></code><br><br>In this version, the age parameter is validated to make sure it does not contain malicious characters.<br>","name":"Cross-Site Scripting - DOM Based","sourceId":"M:659e972c-f9e3-e211-ba22-001e4f12001e","severity":"Medium","businessImpact":"Successful exploitation of cross-site scripting vulnerabilities allows an attacker to run arbitrary script code in the context of the affected user. This can be used to compromise the integrity of content returned by the web server to take over a user's session, redirect the user to a malicious web site, or send requests on behalf of a user. Stolen sessions can be used to take any action the affected user could within an application.  Redirecting users to malicious web sites could be used to propagate malware, discredit the original web site, or trick users into disclosing sensitive information. Sending malicious requests on behalf of an affected user can make it difficult to discover the true origin of the attack.","description":"DOM-based cross-site scripting was discovered within the application. In DOM-based XSS, the client performs the injection of XSS into the page, as opposed to other XSS types (Reflected and Stored XSS) where the server performs the injection. DOM-based XSS generally involves server-controlled, trusted script (such as JavaScript) that is sent to the client and performs sanity checks on a form before the user submits it. If the server-supplied script processes user-supplied data, and then injects it back into the web page (such as with dynamic HTML), then DOM-based XSS is possible.<br><br>The following code snippet (age.html) demonstrates a DOM Cross-Site Scripting vulnerability:<br><br><code>&lt;HTML&gt;<br>    \t&lt;BODY&gt;<br>    \t\tHello!<br>    \t\t&lt;BR&gt;<br>    \t\tYour age is: <br>    \t\t&lt;SCRIPT&gt;<br>    \t\t\tvar position=document.URL.indexOf(\"age=\")+4;<br>    \t\t\tdocument.write(document.URL.substring(position,document.URL.length));<br>    \t\t&lt;/SCRIPT&gt;<br>    \t&lt;/BODY&gt;<br>&lt;/HTML&gt;<br></code><br><br>Normally, this HTML page would be used for presenting the user's age, e.g.: <br><code>http://SERVER/age.html?age=21<br></code><br><br>However, issuing the following request will result in an XSS condition:<br><code>http://SERVER/age.html?age=&lt;script&gt;alert(document.cookie)&lt;/script&gt; <br></code><br><br>Note there is no need for malicious code to be embedded in the server's response for the attack to succeed.<br>"}}}