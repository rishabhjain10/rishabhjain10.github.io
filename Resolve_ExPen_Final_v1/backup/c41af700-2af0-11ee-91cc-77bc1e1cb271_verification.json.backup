{"default_url":null,"content":{"state":2,"taskInstructions":"<h2>Instructions</h2><br>Review the IP spaces associated with their environment and note if Azurei is used.<br>Also review the check in the company information category and update this if there is any Azure cloud usage.<br><br><h2>Variation: Enumeration via Get-FederationEndpoint</h2><br>1. Federation / managed test: This shows you if the domain allows for federated authentication. If so, this may be a spot for credential brute-force attacks.<br><ul><li>https://blog.netspi.com/using-powershell-identify-federated-domains/</li><br></ul><br><code>iex(new-object net.webclient).downloadstring(&quot;https://raw.githubusercontent.com/NetSPI/PowerShell/master/Get-FederationEndpoint.ps1&quot;)<br>Get-FederationEndpoint -domain ampf.com <br></code><br>2. Consider targeting Azure Portal manually, msonline, or the graphing API. Below is a script for automating checks for a group of domains.<br><code>&#35; Import function<br>iex(new-object net.webclient).downloadstring(&quot;https://raw.githubusercontent.com/NetSPI/PowerShell/master/Get-FederationEndpoint.ps1&quot;); <br><br>&#35; Load<br>$domains = gc C:\\temp\\domains.txt<br><br>&#35; Check domains<br>$results = $domains |<br>foreach {<br>\t<br> Get-FederationEndpoint -domain $_<br>}<br><br>&#35; Display results<br>$results<br><br>&#35; Write to file<br>$results | export-csv -notypeinformation c:\\temp\\results.csv<br></code><br><br><h2>Variation: Server Enumeration with Invoke-EnumerateAzureSubDomains </h2><br>1. Read the blog below for general usage.<br><ul><li>https://blog.netspi.com/enumerating-azure-services/</li><br></ul><br>2. Download and load https://github.com/NetSPI/MicroBurst <br>3. Run the function below.<br>Example:<br><code>Invoke-EnumerateAzureSubDomains -Base test12345678 -Verbose<br><br>zurewebsites.net\tApp Services<br>scm.azurewebsites.net\tApp Services - Management<br>p.azurewebsites.net\tApp Services<br>cloudapp.net\tApp Services<br>file.core.windows.net\tStorage Accounts-Files<br>blob.core.windows.net\tStorage Accounts-Blobs<br>queue.core.windows.net\tStorage Accounts-Queues<br>table.core.windows.net\tStorage Accounts-Tables<br>redis.cache.windows.net\tDatabases-Redis<br>documents.azure.com\tDatabases-Cosmos DB<br>database.windows.net\tDatabases-MSSQL<br>vault.azure.net\tKey Vaults<br>onmicrosoft.com\tMicrosoft Hosted Domain<br>mail.protection.outlook.com\tEmail<br>sharepoint.com\tSharePoint<br>azureedge.net\tCDN<br>search.windows.net\tSearch Appliance<br>azure-api.net\tAPI Services<br></code><br><br><h2>Variation: cloud_enum.py</h2><br>1. Download cloud_enum.py from https://github.com/initstring/cloud_enum and follow the installation instructions.<br><code>git clone https://github.com/initstring/cloud_enum.git<br></code><br>2. Run the following command.<br><code>python3 cloud_enum.py -k netspi -ns 1.1.1.1<br><br>&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;<br>        cloud_enum<br>   github.com/initstring<br>&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;<br><br><br>Keywords:    netspi<br>Mutations:   /home/ncroy/tools/cloud_enum/enum_tools/fuzz.txt<br>Brute-list:  /home/ncroy/tools/cloud_enum/enum_tools/fuzz.txt<br><br>[+] Mutations list imported: 242 items<br>[+] Mutated results: 1453 items<br><br><b>[TRUNCATED]</b><br>++++++++++++++++++++++++++<br>       azure checks<br>++++++++++++++++++++++++++<br><br>[+] Checking for Azure Storage Accounts<br>[&#42;] Brute-forcing a list of 471 possible DNS names<br>    [!] DNS Timeout on bigtablenetspi.blob.core.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspibilling.blob.core.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on eventsnetspi.blob.core.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspinet.blob.core.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netnetspi.blob.core.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on opsnetspi.blob.core.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspistats.blob.core.windows.net. Investigate if there are many of these.<br>  HTTP-OK Storage Account: http://netspi.blob.core.windows.net/<br>  HTTP-OK Storage Account: http://netspistorage.blob.core.windows.net/<br><br> Elapsed time: 00:00:39<br><br>[&#42;] Checking 2 accounts for status before brute-forcing<br>[&#42;] Brute-forcing container names in 2 storage accounts<br>[&#42;] Brute-forcing 213 container names in netspistorage.blob.core.windows.net<br>[&#42;] Brute-forcing 213 container names in netspi.blob.core.windows.net<br><br> Elapsed time: 00:00:39<br><br>[+] Checking for Azure Websites<br>[&#42;] Brute-forcing a list of 1453 possible DNS names<br>  Registered Azure Website DNS Name: netspi.azurewebsites.net<br>    [!] DNS Timeout on netspi2.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on aenetspi.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi-bak.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on club-netspi.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi.cluster.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi.emails.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi.graphite.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspikube.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi.mysql.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on production-netspi.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspiproducts.azurewebsites.net. Investigate if there are many of these.<br>    [!] DNS Timeout on static-netspi.azurewebsites.net. Investigate if there are many of these.<br>  Registered Azure Website DNS Name: netspitest.azurewebsites.net<br>  Registered Azure Website DNS Name: netspi-test.azurewebsites.net<br>    [!] DNS Timeout on netspi.troposphere.azurewebsites.net. Investigate if there are many of these.<br><br> Elapsed time: 00:01:19<br><br>[+] Checking for Azure Databases<br>[&#42;] Brute-forcing a list of 1453 possible DNS names<br>    [!] DNS Timeout on 1.netspi.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspiamazon.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi-beta.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi-com.au.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on dbnetspi.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on endpoints.netspi.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on gw-netspi.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on netspildap.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on packagesnetspi.database.windows.net. Investigate if there are many of these.<br>    [!] DNS Timeout on shared.netspi.database.windows.net. Investigate if there are many of these.<br>  Registered Azure Database DNS Name: netspi-test.database.windows.net<br><br> Elapsed time: 00:01:15<br><br>[+] Checking for Azure Virtual Machines<br>[&#42;] Testing across 1 regions defined in the config file<br>[&#42;] Brute-forcing a list of 1453 possible DNS names<br>    [!] DNS Timeout on administratornetspi.eastus.cloudapp.azure.com. Investigate if there are many of these.<br>    [!] DNS Timeout on administrator.netspi.eastus.cloudapp.azure.com. Investigate if there are many of these.<br>    [!] DNS Timeout on gcp-logs-netspi.eastus.cloudapp.azure.com. Investigate if there are many of these.<br>    [!] DNS Timeout on netspipostgres.eastus.cloudapp.azure.com. Investigate if there are many of these.<br>    [!] DNS Timeout on netspiproducts.eastus.cloudapp.azure.com. Investigate if there are many of these.<br>    [!] DNS Timeout on production-netspi.eastus.cloudapp.azure.com. Investigate if there are many of these.<br>    [!] DNS Timeout on netspi-products.eastus.cloudapp.azure.com. Investigate if there are many of these.<br>    [!] DNS Timeout on productsnetspi.eastus.cloudapp.azure.com. Investigate if there are many of these.<br><br> Elapsed time: 00:00:54<br><b>[TRUNCATED]</b><br></code><br>","references":[],"isTaskInstructionsVisible":true,"isCommentMandatory":false,"fields":[],"masterFinding":null}}