{"default_url":null,"content":{"state":2,"taskInstructions":"<h2>Instructions</h2><br>Verify SPF records exist for email domains, white listed IP ranges and domains cannot be hijacked.<br>Check for SPF records on domains being used for email to identify missed SPF records and interesting TXT records that could indicate the use of technologies that could be targeted in future attacks.<br><br><b>Important Notes</b><br><ul><li>SPF records are a type of DNS TXT record.</li><br><li>SPF records contains a list of internet servers allowed to send email for the domain.</li><br><li>SPF records can include a &quot;soft fail&quot; (~all) to indicate that IPs sending email for the domain that are not on the list should be marked as SPAM.</li><br><li>SPF records can include a hard fail (-all) to indicate that IPs sending email for the domain that are not on the list should be blocked.</li><br><li>SPF records may point to another TXT record using the &quot;include:&quot; setting.</li><br></ul><br>Clients getting mail from your domain validate the servers using your SPF records. However, they don't have to honor it.<br><b>Note:</b> As an attacker if you can obtain access to SPF IPs or relay through them you can spoof email from the domain.<br><br><h2>Variation: dig</h2><br>1. Use dig to identify SPF records.<br><code><b>dig txt google.com +short</b><br><br><b><red>&quot;v=spf1 include:_spf.google.com ~all&quot;</red></b><br>&quot;facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95&quot;<br>&quot;apple-domain-verification=30afIBcvSuDV2PLX&quot;<br>&quot;globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8=&quot;<br>&quot;docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e&quot;<br>&quot;google-site-verification=TV9-DBe4R80X4v0M4U_bd_J9cpOJM0nikft0jAgjmsQ&quot;<br>&quot;MS=E4A68B9AB2BB9670BCE15412F62916164C0B20BB&quot;<br>&quot;docusign=1b0a6754-49b1-4db5-8540-d2c12664b289&quot;<br>&quot;google-site-verification=wD8N7i1JTNTkezJ49swvWW48f8_9xveREV4oB-0Hf5o&quot;<br></code><br><h2>Variation: checkdmarc</h2><br>1. Install checkdmarc.<br><code>pip install checkdmarc<br></code><br>2. Run checkdmarc against the target domain and use jq to filter for the SPF record.<br><code><b>checkdmarc google.com | jq '.spf.record'</b><br><br>&quot;v=spf1 include:_spf.google.com ~all&quot;<br></code><br><h2>Variation: dnsrecon</h2><br>1. Run dnsrecon and review the returned records.<br><code><b>dnsrecon -d google.com</b><br><br>[&#42;] std: Performing General Enumeration against: google.com...<br>[-] DNSSEC is not configured for google.com<br>[&#42;]      SOA ns1.google.com 216.239.32.10<br>[&#42;]      SOA ns1.google.com 2001:4860:4802:32::a<br>[&#42;]      NS ns4.google.com 216.239.38.10<br>[&#42;]      NS ns4.google.com 2001:4860:4802:38::a<br>[&#42;]      NS ns3.google.com 216.239.36.10<br>[&#42;]      NS ns3.google.com 2001:4860:4802:36::a<br>[&#42;]      NS ns1.google.com 216.239.32.10<br>[&#42;]      NS ns1.google.com 2001:4860:4802:32::a<br>[&#42;]      NS ns2.google.com 216.239.34.10<br>[&#42;]      NS ns2.google.com 2001:4860:4802:34::a<br>[&#42;]      MX smtp.google.com 172.217.212.27<br>[&#42;]      MX smtp.google.com 172.253.114.27<br>[&#42;]      MX smtp.google.com 172.253.119.27<br>[&#42;]      MX smtp.google.com 108.177.111.27<br>[&#42;]      MX smtp.google.com 74.125.124.27<br>[&#42;]      MX smtp.google.com 2607:f8b0:4001:c03::1a<br>[&#42;]      MX smtp.google.com 2607:f8b0:4001:c22::1b<br>[&#42;]      MX smtp.google.com 2607:f8b0:4001:c23::1a<br>[&#42;]      MX smtp.google.com 2607:f8b0:4001:c14::1b<br>[&#42;]      A google.com 142.250.191.174<br>[&#42;]      AAAA google.com 2607:f8b0:4009:819::200e<br>[&#42;]      <b><red>TXT google.com v=spf1 include:_spf.google.com ~all</red></b><br>[&#42;]      TXT google.com facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95<br>[&#42;]      TXT google.com apple-domain-verification=30afIBcvSuDV2PLX<br>[&#42;]      TXT google.com globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8=<br>[&#42;]      TXT google.com docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e<br>[&#42;]      TXT google.com google-site-verification=TV9-DBe4R80X4v0M4U_bd_J9cpOJM0nikft0jAgjmsQ<br>[&#42;]      TXT google.com MS=E4A68B9AB2BB9670BCE15412F62916164C0B20BB<br>[&#42;]      TXT google.com docusign=1b0a6754-49b1-4db5-8540-d2c12664b289<br>[&#42;]      TXT google.com google-site-verification=wD8N7i1JTNTkezJ49swvWW48f8_9xveREV4oB-0Hf5o<br>[&#42;]      TXT _dmarc.google.com v=DMARC1; p=reject; rua=mailto:mailauth-reports@google.com<br><b>[TRUNCATED]</b><br></code><br><h2><b>Variation: nslookup</b></h2><br>1. Use nslookup and review the returned records.<br><code><b>nslookup -type=txt google.com</b><br><br>Server:         172.24.0.1<br>Address:        172.24.0.1&#35;53<br><br>Non-authoritative answer:<br>google.com      text = <b><red>&quot;v=spf1 include:_spf.google.com ~all&quot;</red></b><br>google.com      text = &quot;facebook-domain-verification=22rm551cu4k0ab0bxsw536tlds4h95&quot;<br>google.com      text = &quot;apple-domain-verification=30afIBcvSuDV2PLX&quot;<br>google.com      text = &quot;globalsign-smime-dv=CDYX+XFHUw2wml6/Gb8+59BsH31KzUr6c1l2BPvqKX8=&quot;<br>google.com      text = &quot;docusign=05958488-4752-4ef2-95eb-aa7ba8a3bd0e&quot;<br>google.com      text = &quot;google-site-verification=TV9-DBe4R80X4v0M4U_bd_J9cpOJM0nikft0jAgjmsQ&quot;<br>google.com      text = &quot;MS=E4A68B9AB2BB9670BCE15412F62916164C0B20BB&quot;<br>google.com      text = &quot;docusign=1b0a6754-49b1-4db5-8540-d2c12664b289&quot;<br>google.com      text = &quot;google-site-verification=wD8N7i1JTNTkezJ49swvWW48f8_9xveREV4oB-0Hf5o&quot;<br><br>Authoritative answers can be found from:<br></code><br><h2>Reporting Requirements</h2><br><ul><li>Follow up on any odd TXT records to determine if related service have vulnerabilities.</li><br><li>Take a screen shot of the command and command output for the email domain that does not have an SPF record.</li><br></ul><br>","references":[],"isTaskInstructionsVisible":true,"isCommentMandatory":false,"fields":[],"masterFinding":{"id":17059062,"exploitInstructions":"","verificationInstructions":"NOTE: WE NEED AUTOMATION TO DO THIS ON SCALE FOR ALL IDENTIFY DOMAINS, OR AT LEAST FEDERATED/MANAGED/EMAIL DOMAINS.<br><br><h2>Instructions</h2><br>Check for SPF records on domains being used for email to identify missed SPF records and interesting TXT records that could indicate the use of technologies that could be targeted in future attacks.<br><br><b>Important Notes</b><br><br><ul><li>SPF records are a type of DNS TXT record.</li><br><li>SPF records contains a list of internet servers allowed to send email for the domain.</li><br><li>SPF records can include a &quot;soft fail&quot; (~all) to indicate that IPs sending email for the domain that are not on the list should be marked as SPAM.</li><br><li>SPF records can include a hard fail (-all) to indicate that IPs sending email for the domain that are not on the list should be blocked.</li><br><li>SPF records may point to another TXT record using the &quot;include:&quot; setting.</li><br></ul><br>Clients getting mail from your domain validate the servers using your SPF records. However, they don't have to honor it.<br> Note: As an attacker if you can obtain access to SPF IPs or relay through them you can spoof email from the domain.<br><br><b>Commands Options</b><br><br><code>dnsrecon -d domain.com -n ns1.nameserver1.com<br>dnsrecon -d domain.com<br></code><br><br>or<br><br><code>dig domain.com txt host ns1.nameserver1.com<br>dig microsoft.com txt<br></code><br><br>or<br><br><code>nslookup -type=TXT domain.com <br></code><br><br>or<br><br><code>Resolve-DnsName domain.com -type TXT<br></code><br>or<br><br>checkdmarc (https://pypi.org/project/checkdmarc/) outputs SPF and DMARC records in a JSON format for a domain<br><code>checkdmarc domain.com<br></code><br><br><h2>Reporting Requirements</h2><br><ul><li>Follow up on any odd TXT records to determine if related service have vulnerabilities.</li><br><li>Take a screen shot of the command and command output for the email domain that does not have an SPF record.</li><br></ul><br><br><h2>Sample Output</h2><br><br>Below is an example of what an existing SPF record looks like:<br><br><code><b>dig domain.com txt host ns1.nameserver1.com</b><br><br>v=spf1 ip4:95.59.2.21 ip4:95.59.2.22 ip4:195.168.1.0/28 mx -all <br></code><br><br>Create domain with spf, associate email with it, sent to it mail server, then check if domain without spfs are still allowed...<br><br><code><b>Resolve-DnsName foxnews.com  -type TXT</b><br><br>Name                                     Type   TTL   Section    Strings<br>----                                     ----   ---   -------    -------<br>foxnews.com                              TXT    299   Answer     {MS=ms40284671}<br>foxnews.com                              TXT    299   Answer     {qRWnq9UOByGW6DnvW8qZ4scp8GbkRYG4bsmSOyP+<br>                                                                 dzlIB+XXQtkNbpBK3qVrJ8E7YT83Bk33z5CPO1L2K<br>                                                                 lH/mA==}<br>foxnews.com                              TXT    299   Answer     {265947818-2009536}<br>foxnews.com                              TXT    299   Answer     {v=spf1 ip4:66.230.193.2<br>                                                                 include:amazonses.com<br>                                                                 include:spf-00136701.pphosted.com -all}<br></code><br>","remediationInstructions":"Consider creating an SPF record for email domains configured with a HardFail to help prevent internet users from spoofing them.<br>","name":"Weak Configuration - SMTP - SPF Record Not Set","sourceId":"M:e4c50f0f-506a-e611-80e5-ecf4bbd04083","severity":"Medium","businessImpact":"Attackers may be able to forge emails from the internet and impersonate an email address from the affected domain.","description":"The Sender Policy Framework (SPF) is an open standard specifying a technical method to prevent sender address forgery. An SPF record is a TXT record in DNS that begins with v=spf1. It includes a list of IPs that sending domain owner has specified as permitted to send email for that domain and it also informs the recipient mail server what to do if an email is received from an IP that is not on the permitted senders list. <br><br>No SPF records appear to exist for the current domains being used for email.<br>"}}}