{"default_url":null,"content":{"state":2,"taskInstructions":"<h2>Instructions</h2><br>Review crt.sh and scraped SSL certificate host names for potential Active Directory domain names.<br>Review fully registered SSL certificates for potential internal hostname, and other information disclosure.<br><br><h2>Variation: Invoke-CTFR-Lookup2.psm1</h2><br>1. Download Invoke-CTFR-Lookup2.psm1<br><code>https://github.com/NetSPI/PowerShell-Private-Old/blob/972bdce8b3f123c98214248b8f3be735f865fc9d/Invoke-CTFR-Lookup2.psm1<br></code><br>2. Run the domain collection and use the -ShowAdDomains flag<br><code>PS C:\\&gt; $Results = Invoke-CTFR-Lookup2 -Verbose -ShowAdDomains  -domain &quot;acme.com&quot; -ADOutputFile c:\\temp\\domains.txt<br>VERBOSE: Imported 1 domain/keyword targets from command line.<br>VERBOSE: Targeting 1 unique domains/keywords.<br>VERBOSE: acme.com<br>VERBOSE:  - Pulling records from crt.sh<br>VERBOSE:  - Cleaning data<br>VERBOSE:  - Processing sub domains<br>VERBOSE: Checking for potential Active Directory domains.<br>VERBOSE: 19 potential Active Directory domains were found.<br>VERBOSE: - api.open.acme.com<br>VERBOSE: - corp.acme.com<br>VERBOSE: - dts.acme.com<br>VERBOSE: - eprocurement.acme.com<br>VERBOSE: - fhirpoint.open.acme.com<br>VERBOSE: - fhirpointdev.open.acme.com<br>VERBOSE: - fhirpointstage.open.acme.com<br>VERBOSE: - fhirpointtest.open.acme.com<br>VERBOSE: - inside.acme.com<br>VERBOSE: - insidetest.acme.com<br>VERBOSE: - intranet.acme.com<br>VERBOSE: - mobility.acme.com<br>VERBOSE: - open.acme.com<br>VERBOSE: - rd.acme.com<br>VERBOSE: - sandbox.open.acme.com<br>VERBOSE: - intranet.open.acme.com<br>VERBOSE: - im.acme.com<br>VERBOSE: - copr.acme.com<br>VERBOSE: - corp.acme.com<br>VERBOSE: 389 domains found.<br>VERBOSE: All done.<br></code><br>3. Review the discovered subdomains.<br><code>PS C:\\&gt; gc C:\\temp\\domains.txt<br>api.open.acme.com<br>corp.acme.com<br>dts.acme.com<br>eprocurement.acme.com<br>fhirpoint.open.acme.com<br>fhirpointdev.open.acme.com<br>fhirpointstage.open.acme.com<br>fhirpointtest.open.acme.com<br>inside.acme.com<br>insidetest.acme.com<br>intranet.acme.com<br>mobility.acme.com<br>open.acme.com<br>rd.acme.com<br>sandbox.open.acme.com<br>intranet.open.acme.com<br>im.acme.com<br>copr.acme.com<br>corp.acme.com<br></code><br>","references":[],"isTaskInstructionsVisible":true,"isCommentMandatory":false,"fields":[],"masterFinding":{"id":17073009,"exploitInstructions":null,"verificationInstructions":"<h2>Instructions</h2><br>Determine if any additional domains, subdomains, or internal ADS domains can be identified by searching https://crt.sh to search for indexed certificates.  If the domains are not in scope consider providing them to the client in a separate document as a value add.<br><br><h2>Variation: Manual Option</h2><br>1.  Enter the company name into the search.  Alternatively, you can provide top level domains to identify additional subdomains.<br><br><code>https://crt.sh/<br></code><br>Note: Sometimes this reveals internal active directory domain names and internal computer names. It can also be handy for identifying origin servers with Akamai is being used.<br><br>2. Review the crt.sh ID information for undocumented domain names.  They should be found in the commonName, alternative names, and description properties.<br><br><h2>Variation: Automated Option via Invoke-CTFR-Lookup.ps1</h2><br>Use the PowerShell script (Invoke-CTFR-Lookup.ps1) from the PowerShell-Private Repo to lookup your company domains.<br><br>1. Download Invoke-CTFR-Lookup.ps1 and open it in PowerShell.  It can be downloaded from https://github.com/NetSPI/PowerShell-Private-Old/blob/main/Invoke-CTFR-Lookup.ps1<br><br><code>Import-Module Invoke-CTFR-Lookup.ps1<br></code><br>or<br><code>iex(new-object system.net.webclient).downloadstring(&quot;https://raw.githubusercontent.com/NetSPI/PowerShell-Private-Old/master/Get-SSLCertInfo-CTFR.psm1&quot;)<br></code><br><br>2. Run the against target domains to get results.  It does support an input file that contains a list of domains.<br>Note: Also use the -output flag to output Resolve friendly XML for importing.<br><br><code>PS C:&gt; <b>Get-SSLCertInfo-CTFR</b> -domain netspi.com -resolveDNS -output netspi.com<br><br>Subdomain                 IP             <br>---------                 --            <br>.netspi.com              N/A<br>rpe-training.netspi.com   34.200.213.80  <br>jenkins.netspi.com        10.2.15.35     <br>resolve-poc2.netspi.com   52.72.49.26    <br>resolve-poc1.netspi.com   34.238.58.169  <br>msp02router01p.netspi.com 10.2.75.50     <br>remotevpn.netspi.com      75.149.151.125 <br>vpn.netspi.com            209.118.108.195<br>msp01router01p.netspi.com 10.1.75.90     <br>autodiscover.netspi.com   10.2.3.4       <br>mail.netspi.com           10.2.3.4       <br>ftp.netspi.com            10.2.21.40     <br>av.netspi.com             10.2.21.214    <br>lyncdiscover.netspi.com   10.2.3.30      <br>lyncweb.netspi.com        10.2.21.6      <br>sip.netspi.com            10.2.3.30      <br>wc.netspi.com             10.2.21.213    <br>dialin.netspi.com         10.2.3.30      <br>meet.netspi.com           10.2.3.30      <br>owapps.netspi.com         10.2.3.22      <br>blog.netspi.com           10.2.21.51     <br>blogs.netspi.com          10.2.21.51     <br>correlatedvm.netspi.com   10.2.21.62     <br>www.netspi.com            104.197.208.225<br></code><br>","remediationInstructions":"Depending on the source of the information and content, remediation steps may not be necessary.  At minimum, attempt to ensure non-public information is removed from existing certificate properties.<br>","name":"General Information - Identified Domains - Certificate Transparency Logs","sourceId":"M:b4458e62-ce50-4533-9543-0e3e42df7416","severity":"Informational","businessImpact":" Information such as internal server names and Active Directory domains could potentially be used in future attacks. <br>","description":"It was possible to enumerate domains, subdomains, internal hostnames, or additional information from Certificate Transparency Logs that may be considered non-public.<br><br>Certificate Transparency is an open framework that monitors and audits TLS/SSL certificates. Certificate Transparency Logs include all publicly trusted digital certificates. The certificates logs include information about the public key, issuer, and fields that can contain internal host names and notes. <br>The logs are secured by a cryptographic structure called a Merkle hash tree. It supports an append-only log that prevents deletion or modification of previously added records. These records can be used by the domain owner to verify if the certificate was issued by a trusted CA or issued maliciously, and is intended to help prevent people from accepting fraudulent certificates.<br>"}}}