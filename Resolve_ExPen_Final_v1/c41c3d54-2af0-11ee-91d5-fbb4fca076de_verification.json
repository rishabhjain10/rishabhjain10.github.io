{"default_url":null,"content":{"state":2,"taskInstructions":"<h2>Instructions</h2><br>Review crt.sh and scraped SSL certificate host names for potential Active Directory domain names.<br><br><b>Note:</b> Start the review with self-signed certs.<br><br><h2><b>Variation: Automation with Invoke-CTFR-Lookup2</b></h2><br>1. Download and load https://github.com/NetSPI/PowerShell-Private/blob/master/Invoke-CTFR-Lookup2.psm1<br><br>2. Run the domain collection and use the -ShowAdDomains flag.<br><code>PS C:&gt; <b>$Results = Invoke-CTFR-Lookup2 -Verbose -ShowAdDomains -domain &quot;acme.com&quot; -ADOutputFile c:\\temp\\domains.txt</b><br><br>VERBOSE: Imported 1 domain/keyword targets from command line.<br>VERBOSE: Targeting 1 unique domains/keywords.<br>VERBOSE: acme.com<br>VERBOSE:  - Pulling records from crt.sh<br>VERBOSE:  - Cleaning data<br>VERBOSE:  - Processing sub domains<br>VERBOSE: Checking for potential Active Directory domains.<br>VERBOSE: 19 potential Active Directory domains were found.<br>VERBOSE: - api.open.acme.com<br>VERBOSE: - corp.acme.com<br>VERBOSE: - dts.acme.com<br>VERBOSE: - eprocurement.acme.com<br>VERBOSE: - fhirpoint.open.acme.com<br>VERBOSE: - fhirpointdev.open.acme.com<br>VERBOSE: - fhirpointstage.open.acme.com<br>VERBOSE: - fhirpointtest.open.acme.com<br>VERBOSE: - inside.acme.com<br>VERBOSE: - insidetest.acme.com<br>VERBOSE: - intranet.acme.com<br>VERBOSE: - mobility.acme.com<br>VERBOSE: - open.acme.com<br>VERBOSE: - rd.acme.com<br>VERBOSE: - sandbox.open.acme.com<br>VERBOSE: - intranet.open.acme.com<br>VERBOSE: - im.acme.com<br>VERBOSE: - copr.acme.com<br>VERBOSE: - corp.acme.com<br>VERBOSE: 389 domains found.<br>VERBOSE: All done.<br><br>PS C:&gt;<b> gc c:\\temp\\domain.txt</b><br><br>api.open.acme.com<br>corp.acme.com<br>dts.acme.com<br>eprocurement.acme.com<br>fhirpoint.open.acme.com<br>fhirpointdev.open.acme.com<br>fhirpointstage.open.acme.com<br>fhirpointtest.open.acme.com<br>inside.acme.com<br>insidetest.acme.com<br>intranet.acme.com<br>mobility.acme.com<br>open.acme.com<br>rd.acme.com<br>sandbox.open.acme.com<br>intranet.open.acme.com<br>im.acme.com<br>copr.acme.com<br>corp.acme.com<br></code><br>","references":[],"isTaskInstructionsVisible":true,"isCommentMandatory":false,"fields":[],"masterFinding":{"id":17064791,"exploitInstructions":"","verificationInstructions":"Review crt.sh and scraped SSL certificate host names for potential Active Directory domain names.<br><br>Review fully registered SSL certificates for potential internal hostname, and other information discolosure.<br><br><b>Instructions</b><br><br><b>Download Invoke-CTFR-Lookup2.psm1</b><br><br>https://github.com/NetSPI/PowerShell-Private-Old/blob/main/Invoke-CTFR-Lookup2.psm1<br><br><b>Run the domain collection and use the -ShowAdDomains flag</b><br><br>PS C:\\&gt; $Results = Invoke-CTFR-Lookup2 -Verbose -ShowAdDomains  -domain &quot;acme.com&quot; -ADOutputFile c:\\temp\\domains.txt<br>VERBOSE: Imported 1 domain/keyword targets from command line.<br>VERBOSE: Targeting 1 unique domains/keywords.<br>VERBOSE: acme.com<br>VERBOSE:  - Pulling records from crt.sh<br>VERBOSE:  - Cleaning data<br>VERBOSE:  - Processing sub domains<br>VERBOSE: Checking for potential Active Directory domains.<br>VERBOSE: 19 potential Active Directory domains were found.<br>VERBOSE: - api.open.acme.com<br>VERBOSE: - corp.acme.com<br>VERBOSE: - dts.acme.com<br>VERBOSE: - eprocurement.acme.com<br>VERBOSE: - fhirpoint.open.acme.com<br>VERBOSE: - fhirpointdev.open.acme.com<br>VERBOSE: - fhirpointstage.open.acme.com<br>VERBOSE: - fhirpointtest.open.acme.com<br>VERBOSE: - inside.acme.com<br>VERBOSE: - insidetest.acme.com<br>VERBOSE: - intranet.acme.com<br>VERBOSE: - mobility.acme.com<br>VERBOSE: - open.acme.com<br>VERBOSE: - rd.acme.com<br>VERBOSE: - sandbox.open.acme.com<br>VERBOSE: - intranet.open.acme.com<br>VERBOSE: - im.acme.com<br>VERBOSE: - copr.acme.com<br>VERBOSE: - corp.acme.com<br>VERBOSE: 389 domains found.<br>VERBOSE: All done.<br><br>PS C:\\&gt; gc C:\\temp\\domains.txt<br>api.open.acme.com<br>corp.acme.com<br>dts.acme.com<br>eprocurement.acme.com<br>fhirpoint.open.acme.com<br>fhirpointdev.open.acme.com<br>fhirpointstage.open.acme.com<br>fhirpointtest.open.acme.com<br>inside.acme.com<br>insidetest.acme.com<br>intranet.acme.com<br>mobility.acme.com<br>open.acme.com<br>rd.acme.com<br>sandbox.open.acme.com<br>intranet.open.acme.com<br>im.acme.com<br>copr.acme.com<br>corp.acme.com<br>","remediationInstructions":"Ensure that SSL certificates used by internal servers are issued by an internal certificate authority and not an external certificate authority.  Additionally, do not specify internal systems or domains in the SAN field for the certificate.<br><br>If the SSL certificate is being used for external-facing infrastructure, split the certificate to cover a single domain only, such that additional domains are not exposed to the requestor. If this is not possible, consider using wildcard domains in certificate to mask exact domain names from requestors.<br><br>Corrective actions may not be required, but it is important to be aware that data from Certificate Transparency Logs can be viewed and leveraged by attackers. <br>","name":"General Information - Domains - SSL Certificate Transparency Logs","sourceId":"M:f5507095-5d77-4ced-9b7a-fba95fa3c0b1","severity":"Informational","businessImpact":"Non-public information (Internal Hostnames, Emal Addresses, etc.) gathered from SSL certifcates could potentially be used in future attacks.","description":"It was possible to recover potentially non-public information from an SSL certificate associated with an in-scope domain via SSL certificate transparency logs.<br>"}}}